# UAT Test: US-P8-002-FIX - Fix Trust Gate Check in Voice Notes Dashboard

> Auto-generated: 2026-01-27 20:42
> Status: ⏳ Pending Execution

## Story
As a coach, I want the 'Sent to Parents' tab visibility to respect the new feature flag system so access is controlled by Platform/Admin settings while preserving the trust level system.

## Acceptance Criteria Checklist

- [ ] Modify apps/web/src/app/orgs/[orgId]/coach/voice-notes/voice-notes-dashboard.tsx
- [ ] Import new query:
- [ ] import { api } from '@/convex/_generated/api';
- [ ] (already imported, verify present)
- [ ] Add feature flag check:
- [ ] const gateStatus = useQuery(
- [ ] api.models.trustGatePermissions.areTrustGatesActive,
- [ ] coachId && orgId ? { coachId, organizationId: orgId } : 'skip'
- [ ] );
- [ ] Calculate visibility:
- [ ] const shouldShowSentToParents = useMemo(() => {
- [ ] // Loading state
- [ ] if (gateStatus === undefined) return false;
- [ ] // Gates disabled via flags (any tier)
- [ ] if (!gateStatus.gatesActive) return true;
- [ ] // Gates active - check trust level
- [ ] const currentLevel = trustLevel?.currentLevel ?? 0;
- [ ] return currentLevel >= 2;
- [ ] }, [gateStatus, trustLevel]);
- [ ] Replace removed gate with conditional push:
- [ ] if (shouldShowSentToParents) {
- [ ] baseTabs.push({
- [ ] id: 'auto-sent',
- [ ] label: 'Sent to Parents',
- [ ] icon: Send,
- [ ] });
- [ ] }
- [ ] Add info UI for locked state:
- [ ] {!shouldShowSentToParents && (
- [ ] <Tooltip>
- [ ] <TooltipTrigger asChild>
- [ ] <Button variant='ghost' disabled className='opacity-50'>
- [ ] <Lock className='h-4 w-4 mr-2' />
- [ ] Sent to Parents
- [ ] </Button>
- [ ] </TooltipTrigger>
- [ ] <TooltipContent>
- [ ] <p>
- [ ] {gateStatus?.source === 'org_default' && 'Available at Trust Level 2+'}
- [ ] {gateStatus?.source === 'admin_blanket' && 'Contact your administrator for access'}
- [ ] </p>
- [ ] </TooltipContent>
- [ ] </Tooltip>
- [ ] )}
- [ ] Preserve all existing functionality:
- [ ] - Tab switching still works
- [ ] - Search/filter in Sent to Parents tab unchanged
- [ ] - Parent view/acknowledge status display unchanged
- [ ] Type check passes: npm run check-types
- [ ] Visual verification:
- [ ] - Level 0/1 coach + gates ON → Tab hidden, locked button shows with tooltip
- [ ] - Level 0/1 coach + admin override ON → Tab visible
- [ ] - Level 0/1 coach + individual override → Tab visible
- [ ] - Level 2+ coach + gates ON → Tab visible (trust level sufficient)
- [ ] - Level 2+ coach + gates OFF → Tab visible

## Test Scenarios

### Happy Path
1. Navigate to the feature
2. Perform the primary action described in the story
3. Verify all acceptance criteria are met
4. **Expected:** Feature works as described

### Edge Cases
1. Test with empty/null values
2. Test with boundary values
3. Test rapid repeated actions
4. **Expected:** Graceful handling, no errors

### Error Handling
1. Test with invalid inputs
2. Test without proper permissions
3. Test with network issues (if applicable)
4. **Expected:** Clear error messages, no crashes

## Visual Verification
- [ ] UI matches design expectations
- [ ] Responsive on mobile (if applicable)
- [ ] Loading states are appropriate
- [ ] Error states are user-friendly

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
