# UAT Test: US-P4.1-005 - Create API client abstraction for federation requests

> Auto-generated: 2026-02-15 21:11
> Status: ‚è≥ Pending Execution

## Story
As a developer, I need a reusable API client that handles authentication, retries, and rate limiting for all federation API calls.

## Acceptance Criteria Checklist

- [ ] Create packages/backend/convex/lib/federation/apiClient.ts
- [ ] Export FederationApiClient class with constructor(connectorId)
- [ ] Implement request method: async request<T>(endpoint, options) => Promise<T>
- [ ] Loads connector from database, decrypts credentials
- [ ] Adds authentication headers based on authType:
- [ ] - OAuth2: Authorization: Bearer {access_token}
- [ ] - API Key: X-API-Key: {api_key}
- [ ] - Basic: Authorization: Basic {base64(username:password)}
- [ ] Checks if OAuth token expired, refreshes if needed before request
- [ ] Implements retry logic with exponential backoff (3 retries max)
- [ ] Implements rate limiting: tracks requests per minute, delays if limit exceeded
- [ ] Throws FederationApiError with status code and error message on failure
- [ ] Add TypeScript types: FederationApiOptions, FederationApiError
- [ ] Run npx ultracite fix

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-P4.1-005"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
