# Ralph Progress Log
Started: Mon 20 Jan 2026 (Phase 4)
Branch: ralph/coach-parent-summaries-p4
---

## CODEBASE PATTERNS - READ FIRST!

### Critical Convex Patterns
```typescript
// ALWAYS use .withIndex(), NEVER use .filter()
const result = await ctx.db.query("tableName")
  .withIndex("by_field", q => q.eq("field", value))
  .first();

// Auth pattern
const user = await authComponent.safeGetAuthUser(ctx);
if (!user?.userId) throw new Error("Not authenticated");

// Guardian lookup (for parent features)
const guardian = await ctx.db.query("guardianIdentities")
  .withIndex("by_userId", q => q.eq("userId", user.userId))
  .first();

// Access verification
const link = await ctx.db.query("guardianPlayerLinks")
  .withIndex("by_guardian_and_player", q =>
    q.eq("guardianIdentityId", guardian._id).eq("playerIdentityId", playerId))
  .first();
if (!link) throw new Error("Access denied");

// Storage pattern for images
const storageId = await ctx.storage.store(new Blob([buffer]));
const url = await ctx.storage.getUrl(storageId);
```

### TypeScript Narrowing - CRITICAL
```typescript
// DO: Assign optional args to const for narrowing
const status = args.status;
if (status) { /* status is now string, not string | undefined */ }

// DON'T: Args don't narrow in callbacks
if (args.status) { /* args.status is STILL string | undefined */ }
```

### Biome Rules - WILL FAIL CI IF VIOLATED
- NO `++` or `--` operators - use `+= 1`
- NO `value!` assertions - use proper narrowing
- Regex patterns MUST be at file top-level, NOT inside functions
- Imports get REMOVED if usage not in same edit - use Write for new files

### React/Frontend
- Import: `import { api } from "@pdp/backend/convex/_generated/api";`
- Key must be JSX attribute: `<Card key={item._id} />`
- Use explicit if/else for conditional component rendering

## CODE REVIEW FEEDBACK

(Agents will write feedback here during the run)

---

## Iteration Log

(Progress entries will be added here as stories complete)

