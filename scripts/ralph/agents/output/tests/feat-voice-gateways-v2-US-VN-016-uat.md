# UAT Test: US-VN-016 - Pipeline Integration & Claims Viewer

> Auto-generated: 2026-02-06 22:28
> Status: â³ Pending Execution

## Story
Hook claims extraction into the v2 pipeline after transcription (parallel with v1 buildInsights). Add platform-staff debug page to view extracted claims. Zero regression to v1 pipeline.

## Acceptance Criteria Checklist

- [ ] PIPELINE HOOK: Modify packages/backend/convex/actions/voiceNotes.ts
- [ ] Location: Inside 'if (artifacts.length > 0)' block (line ~233), AFTER transcript creation + artifact status set to 'transcribed' (line ~257), BEFORE quality check branching (line ~260)
- [ ] Add: await ctx.scheduler.runAfter(0, internal.actions.claimsExtraction.extractClaims, { artifactId: artifact._id })
- [ ] This runs in parallel with v1 buildInsights (scheduled at line 280-286, UNCHANGED)
- [ ] Non-v2 coaches unaffected (no artifact = no scheduler call)
- [ ] QUERY: Add getRecentArtifacts (PUBLIC query) to packages/backend/convex/models/voiceNoteArtifacts.ts
- [ ] args: { limit: v.optional(v.number()) }
- [ ] Logic: query voiceNoteArtifacts, order desc, take min(limit || 50, 200)
- [ ] Used by the claims viewer frontend
- [ ] OPTIONAL QUERY: Add getRecentClaims (PUBLIC query) to packages/backend/convex/models/voiceNoteClaims.ts
- [ ] args: { limit: v.optional(v.number()) }
- [ ] Logic: query voiceNoteClaims, order desc, take min(limit || 100, 500)
- [ ] Used by the claims viewer if getClaimsByOrgAndCoach doesn't fit the platform debug use case
- [ ] CLAIMS VIEWER: Create apps/web/src/app/platform/v2-claims/page.tsx
- [ ] Follow apps/web/src/app/platform/ai-config/page.tsx pattern
- [ ] 'use client' component, useCurrentUser() for auth
- [ ] useQuery for artifacts and claims
- [ ] Layout: header with back link, stats cards, artifact list with expandable claims
- [ ] Each claim: topic badge (color-coded), sourceText, title, entity mentions, confidence, status
- [ ] Uses shadcn/ui: Card, Badge, Table, Skeleton
- [ ] No org theming (platform admin tool)
- [ ] VERIFICATION:
- [ ] npm run check-types passes
- [ ] npm run build succeeds
- [ ] Manual: v2 coach voice note creates BOTH v1 insights AND v2 claims
- [ ] Manual: non-v2 coach voice note creates ONLY v1 insights (no claims)
- [ ] Manual: /platform/v2-claims page loads with claims displayed

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-VN-016"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
