# UAT Test: US-P3.1-008 - Implement atomic removal transaction

> Auto-generated: 2026-02-14 23:51
> Status: ‚è≥ Pending Execution

## Story
As a system, I need to remove selected players and all related data in a single transaction so the database remains consistent even if removal fails.

## Acceptance Criteria Checklist

- [ ] Create removePlayersFromImport mutation in playerImport.ts
- [ ] Mutation accepts: sessionId, playerIdentityIds[] to remove
- [ ] Transaction removes in order (reverse of creation):
- [ ] 1. Skill assessments for these players
- [ ] 2. Team assignments (teamPlayerIdentities)
- [ ] 3. Sport passports
- [ ] 4. Guardian links (guardianToPlayerLinks) - only if guardian orphaned
- [ ] 5. Enrollments (orgPlayerEnrollments)
- [ ] 6. Player identities (if not linked elsewhere)
- [ ] Use ctx.db.delete() for each record, wrapped in try-catch
- [ ] Roll back on any error (Convex mutations are atomic)
- [ ] Update importSession stats: subtract removed counts from totals
- [ ] Return removal result: { playersRemoved, enrollmentsRemoved, passportsRemoved, guardiansOrphaned, errors[] }
- [ ] Run npx -w packages/backend convex codegen after adding mutation
- [ ] Run npx ultracite fix before completion

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-P3.1-008"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
