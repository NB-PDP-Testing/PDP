{
  "project": "P8 Week 2 - My Impact Dashboard Components",
  "branchName": "ralph/coach-impact-visibility-p8-week1",
  "description": "Build complete My Impact dashboard with 4 new components: summary cards, sent summaries section, applied insights section with search/filters, and team observations. All frontend work - no backend changes needed (getCoachImpactSummary already exists from Week 1).",
  "readinessLevel": "100% - Ready to Start",
  "urgency": "MEDIUM - Week 1 & 1.5 complete, dashboard scaffolding in place",
  "prerequisitesCompleted": {
    "status": "✅ ALL PREREQUISITES COMPLETE - Jan 28, 2026",
    "completedWork": [
      "✅ Week 1 Complete (Jan 27, 2026):",
      "  - US-P8-001: getCoachImpactSummary backend query (packages/backend/convex/models/voiceNotes.ts:2041)",
      "  - US-P8-003: my-impact-tab.tsx skeleton with date filtering (apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/my-impact-tab.tsx)",
      "  - US-P8-004: My Impact tab visible in navigation",
      "",
      "✅ Week 1.5 Complete (Jan 28, 2026):",
      "  - 9 stories delivered (5 planned + 4 enhancements)",
      "  - Trust gate system with 8-priority access logic",
      "  - Coach self-service toggle, admin controls",
      "  - Better Auth integration patterns documented",
      "",
      "✅ my-impact-tab.tsx Current State:",
      "  - Date range filtering: week, month, all time (localStorage persistence)",
      "  - Loading state: 4 skeleton cards + content sections",
      "  - Empty state: 'No voice notes yet' with CTA",
      "  - Placeholder sections for Week 2 work (lines 197-265)",
      "  - Query to getCoachImpactSummary with dateRange parameter",
      "",
      "✅ Backend Query Available:",
      "  - Returns: voiceNotesCreated, insightsApplied, summariesSent, parentViewRate",
      "  - Returns: skillChanges[], injuriesRecorded[], recentSummaries[], teamObservations[]",
      "  - Returns: parentEngagement[], weeklyTrends[]",
      "  - All data filtered by dateRange (start, end timestamps)"
    ],
    "documentationReferences": [
      "scripts/ralph/P8_CHECKPOINT_JAN28.md - Complete Week 1 & 1.5 status",
      "scripts/ralph/P8_WEEK2_RALPH_CONTEXT.md - CRITICAL Better Auth patterns from Week 1.5",
      "scripts/ralph/P8_WEEK2_PREPARATION.md - Complete Week 2 implementation guide",
      "scripts/ralph/prds/Coaches Voice Insights/P8_COACH_IMPACT_VISIBILITY.md - Main PRD (Week 2 section)"
    ]
  },
  "contextAndDependencies": {
    "criticalContext": [
      "FRONTEND ONLY - No backend changes needed in Week 2",
      "All data comes from getCoachImpactSummary query (already exists)",
      "4 new components to create: impact-summary-cards.tsx, sent-summaries-section.tsx, applied-insights-section.tsx, team-observations-section.tsx",
      "1 component to modify: my-impact-tab.tsx (replace placeholders with real components)",
      "All components must handle: loading state, empty state, real-time updates"
    ],
    "criticalPatternsFromWeek1_5": {
      "BetterAuthIntegration": "CRITICAL - Do NOT query organization/team/member/user tables directly. Week 1.5 revealed that Better Auth manages these tables. If Week 2 needs org/team data, must use ctx.runQuery(components.betterAuth.adapter.findMany, {...}). See P8_WEEK2_RALPH_CONTEXT.md for complete patterns.",
      "ConvexQueryPattern": "Use useQuery for all data fetching, provides real-time updates automatically",
      "LoadingStates": "Check if data === undefined for loading, show Skeleton components",
      "EmptyStates": "Check if data array length === 0, show Empty component with icon + message",
      "ToastNotifications": "Use toast from 'sonner' for success/error feedback (not needed for read-only dashboard)",
      "ResponsiveDesign": "Mobile-first: grid-cols-1, md:grid-cols-2, lg:grid-cols-4",
      "DateFormatting": "Use formatDistanceToNow for recent (< 7 days), format for older dates"
    },
    "requiredTables": [
      "✅ voiceNotes - Already queried by getCoachImpactSummary",
      "✅ voiceNoteInsights - Already queried by getCoachImpactSummary",
      "✅ coachParentSummaries - Already queried by getCoachImpactSummary",
      "✅ autoAppliedInsights - Already queried by getCoachImpactSummary",
      "✅ playerInjuries - Already queried by getCoachImpactSummary",
      "✅ teamObservations - Already queried by getCoachImpactSummary"
    ],
    "keyFiles": [
      "Frontend: apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/my-impact-tab.tsx - MODIFY (replace placeholders)",
      "Frontend: apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/impact-summary-cards.tsx - CREATE NEW",
      "Frontend: apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/sent-summaries-section.tsx - CREATE NEW",
      "Frontend: apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/applied-insights-section.tsx - CREATE NEW",
      "Frontend: apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/team-observations-section.tsx - CREATE NEW",
      "Backend: packages/backend/convex/models/voiceNotes.ts - READ ONLY (getCoachImpactSummary exists at line 2041)"
    ],
    "criticalPatterns": {
      "ComponentProps": "Accept data prop from parent (my-impact-tab.tsx passes impactData down)",
      "TypeSafety": "Import types from @pdp/backend/convex/_generated/api",
      "Icons": "Use lucide-react icons: Mic, CheckCircle, Send, Eye, TrendingUp, AlertCircle, Calendar",
      "Links": "Use Next.js Link component for navigation to player passports",
      "Performance": "Use useMemo for filtering/sorting, debounce search input (300ms)"
    }
  },
  "userStories": [
    {
      "id": "US-P8-005",
      "title": "Create Impact Summary Cards Component",
      "description": "As a coach, I want to see 4 key metrics at the top of My Impact so I can quickly understand my coaching activity.",
      "phase": "P8 Week 2: My Impact Dashboard",
      "acceptanceCriteria": [
        "Create apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/impact-summary-cards.tsx",
        "",
        "Component structure:",
        "  export function ImpactSummaryCards({ data }: { data: { voiceNotesCreated: number, insightsApplied: number, summariesSent: number, parentViewRate: number } })",
        "",
        "4 cards in responsive grid:",
        "  1. Voice Notes Created (blue, icon: Mic)",
        "     - Label: 'Voice Notes'",
        "     - Value: data.voiceNotesCreated",
        "     - Icon in blue circle: bg-blue-100 text-blue-600",
        "",
        "  2. Insights Applied (green, icon: CheckCircle)",
        "     - Label: 'Insights Applied'",
        "     - Value: data.insightsApplied",
        "     - Icon in green circle: bg-green-100 text-green-600",
        "",
        "  3. Summaries Sent (purple, icon: Send)",
        "     - Label: 'Sent to Parents'",
        "     - Value: data.summariesSent",
        "     - Icon in purple circle: bg-purple-100 text-purple-600",
        "",
        "  4. Parent View Rate (amber, icon: Eye)",
        "     - Label: 'Parent View Rate'",
        "     - Value: data.parentViewRate.toFixed(1) + '%'",
        "     - Icon in amber circle: bg-amber-100 text-amber-600",
        "",
        "Grid responsive classes: 'grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4'",
        "",
        "Each card uses shadcn Card component:",
        "  <Card>",
        "    <CardContent className='p-6'>",
        "      <div className='flex items-center gap-4'>",
        "        <div className='flex h-12 w-12 items-center justify-center rounded-full {colorClass}'>",
        "          <Icon className='h-6 w-6' />",
        "        </div>",
        "        <div>",
        "          <p className='text-muted-foreground text-sm'>{label}</p>",
        "          <p className='font-bold text-2xl'>{value}</p>",
        "        </div>",
        "      </div>",
        "    </CardContent>",
        "  </Card>",
        "",
        "Modify my-impact-tab.tsx:",
        "  - Import: import { ImpactSummaryCards } from './impact-summary-cards';",
        "  - Replace placeholder (lines 197-215) with: <ImpactSummaryCards data={impactData} />",
        "",
        "Type check passes: npm run check-types",
        "Visual verification: Cards display correctly at 375px (mobile), 768px (tablet), 1920px (desktop)"
      ],
      "technicalNotes": {
        "imports": [
          "import { Card, CardContent } from '@/components/ui/card';",
          "import { Mic, CheckCircle, Send, Eye } from 'lucide-react';"
        ],
        "extractSubcomponent": "Consider creating StatCard subcomponent for reuse",
        "colorPattern": "bg-{color}-100 text-{color}-600 for icon circles",
        "referenceFile": "scripts/ralph/P8_WEEK2_PREPARATION.md - Component Structure section"
      },
      "priority": 1,
      "passes": false,
      "estimatedTime": "2-3 hours",
      "notes": "First Week 2 story. Start here. Creates visible dashboard impact immediately."
    },
    {
      "id": "US-P8-006",
      "title": "Create Sent Summaries Section Component",
      "description": "As a coach, I want to see all summaries I've sent to parents with engagement status so I know who's viewing and acknowledging.",
      "phase": "P8 Week 2: My Impact Dashboard",
      "acceptanceCriteria": [
        "Create apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/sent-summaries-section.tsx",
        "",
        "Component structure:",
        "  export function SentSummariesSection({ summaries }: { summaries: Array<{ summaryId, playerName, summaryPreview, sentAt, viewedAt?, acknowledgedAt? }> })",
        "",
        "Section header:",
        "  <div className='mb-4 flex items-center justify-between'>",
        "    <h3 className='font-semibold text-lg'>Sent to Parents</h3>",
        "    <Badge variant='secondary'>{summaries.length} summaries</Badge>",
        "  </div>",
        "",
        "Table structure (desktop):",
        "  <Table>",
        "    <TableHeader>",
        "      <TableRow>",
        "        <TableHead>Player</TableHead>",
        "        <TableHead>Summary</TableHead>",
        "        <TableHead>Sent At</TableHead>",
        "        <TableHead>Status</TableHead>",
        "      </TableRow>",
        "    </TableHeader>",
        "    <TableBody>",
        "      {summaries.slice(0, 10).map(summary => (",
        "        <TableRow key={summary.summaryId}>",
        "          <TableCell>{summary.playerName}</TableCell>",
        "          <TableCell className='max-w-md truncate'>{summary.summaryPreview}</TableCell>",
        "          <TableCell>{formatDistanceToNow(new Date(summary.sentAt), { addSuffix: true })}</TableCell>",
        "          <TableCell>",
        "            {summary.acknowledgedAt ? <Badge variant='default'>Acknowledged</Badge> :",
        "             summary.viewedAt ? <Badge variant='secondary'>Viewed</Badge> :",
        "             <Badge variant='outline'>Sent</Badge>}",
        "          </TableCell>",
        "        </TableRow>",
        "      ))}",
        "    </TableBody>",
        "  </Table>",
        "",
        "Mobile layout (< 768px):",
        "  - Stack as cards instead of table",
        "  - Use className='md:hidden' for card view, 'hidden md:block' for table view",
        "",
        "Empty state:",
        "  {summaries.length === 0 && (",
        "    <Empty>",
        "      <EmptyMedia><Send className='h-12 w-12' /></EmptyMedia>",
        "      <EmptyContent>",
        "        <EmptyTitle>No summaries sent yet</EmptyTitle>",
        "        <EmptyDescription>Summaries you send to parents will appear here</EmptyDescription>",
        "      </EmptyContent>",
        "    </Empty>",
        "  )}",
        "",
        "'View All' button (if > 10 summaries):",
        "  {summaries.length > 10 && (",
        "    <Button variant='outline' onClick={() => setActiveTab('auto-sent')}>",
        "      View All {summaries.length} Summaries",
        "    </Button>",
        "  )}",
        "",
        "Modify my-impact-tab.tsx:",
        "  - Import: import { SentSummariesSection } from './sent-summaries-section';",
        "  - Replace placeholder (lines 217-231) with: <SentSummariesSection summaries={impactData.recentSummaries} />",
        "",
        "Type check passes: npm run check-types",
        "Visual verification: Table displays on desktop, cards on mobile, status badges correct colors"
      ],
      "technicalNotes": {
        "imports": [
          "import { Table, TableHeader, TableHead, TableBody, TableRow, TableCell } from '@/components/ui/table';",
          "import { Badge } from '@/components/ui/badge';",
          "import { Button } from '@/components/ui/button';",
          "import { Send } from 'lucide-react';",
          "import { formatDistanceToNow } from 'date-fns';",
          "import { Empty, EmptyMedia, EmptyContent, EmptyTitle, EmptyDescription } from '@/components/ui/empty';"
        ],
        "responsivePattern": "Use Tailwind breakpoint classes: hidden md:block for table, md:hidden for cards",
        "statusBadges": "Acknowledged (green, variant='default'), Viewed (gray, variant='secondary'), Sent (outline)",
        "referenceFile": "scripts/ralph/P8_WEEK2_PREPARATION.md - Design Patterns section"
      },
      "priority": 2,
      "passes": false,
      "estimatedTime": "3-4 hours",
      "notes": "Second story. Addresses core user pain point: parent engagement visibility."
    },
    {
      "id": "US-P8-007",
      "title": "Create Applied Insights Section Component",
      "description": "As a coach, I want to see insights I've applied grouped by category so I understand what types of observations I'm making.",
      "phase": "P8 Week 2: My Impact Dashboard",
      "acceptanceCriteria": [
        "Create apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/applied-insights-section.tsx",
        "",
        "Component structure:",
        "  export function AppliedInsightsSection({ skillChanges, injuries }: { skillChanges: Array<{...}>, injuries: Array<{...}> })",
        "",
        "Group insights by category:",
        "  - Skills: from skillChanges array (green, icon: TrendingUp)",
        "  - Injuries: from injuries array (red, icon: AlertCircle)",
        "",
        "Section header with total count:",
        "  <h3 className='mb-4 font-semibold text-lg'>",
        "    Applied to Player Profiles",
        "    <Badge variant='secondary' className='ml-2'>{totalCount} insights</Badge>",
        "  </h3>",
        "",
        "Category sections (collapsible):",
        "  const [expandedCategory, setExpandedCategory] = useState<string | null>('skills');",
        "",
        "  <Collapsible open={expandedCategory === 'skills'} onOpenChange={() => setExpandedCategory(expandedCategory === 'skills' ? null : 'skills')}>",
        "    <CollapsibleTrigger className='flex w-full items-center justify-between rounded-lg border p-4 hover:bg-muted'>",
        "      <div className='flex items-center gap-3'>",
        "        <div className='flex h-10 w-10 items-center justify-center rounded-full bg-green-100'>",
        "          <TrendingUp className='h-5 w-5 text-green-600' />",
        "        </div>",
        "        <div>",
        "          <p className='font-medium'>Skills</p>",
        "          <p className='text-muted-foreground text-sm'>{skillChanges.length} changes</p>",
        "        </div>",
        "      </div>",
        "      <ChevronDown className={cn('h-4 w-4 transition-transform', expandedCategory === 'skills' && 'rotate-180')} />",
        "    </CollapsibleTrigger>",
        "    <CollapsibleContent className='mt-2 space-y-2 px-4'>",
        "      {skillChanges.slice(0, 5).map(skill => (",
        "        <Card key={skill.targetRecordId}>",
        "          <CardContent className='p-4'>",
        "            <div className='flex items-start justify-between'>",
        "              <div className='flex-1'>",
        "                <p className='font-medium'>{skill.playerName}</p>",
        "                <p className='text-muted-foreground text-sm'>{skill.description}</p>",
        "                <p className='mt-1 text-muted-foreground text-xs'>",
        "                  {formatDistanceToNow(new Date(skill.appliedAt), { addSuffix: true })}",
        "                </p>",
        "              </div>",
        "              <Link href={`/orgs/${orgId}/players/${skill.playerIdentityId}/passport?tab=skills`}>",
        "                <Button variant='ghost' size='sm'>View in Passport →</Button>",
        "              </Link>",
        "            </div>",
        "          </CardContent>",
        "        </Card>",
        "      ))}",
        "      {skillChanges.length > 5 && (",
        "        <Button variant='outline' size='sm' className='w-full'>View All {skillChanges.length} Skills</Button>",
        "      )}",
        "    </CollapsibleContent>",
        "  </Collapsible>",
        "",
        "Repeat pattern for Injuries category (red, AlertCircle icon)",
        "",
        "Empty state per category:",
        "  {skillChanges.length === 0 && <p className='text-muted-foreground text-center text-sm py-4'>No skill changes yet</p>}",
        "",
        "Modify my-impact-tab.tsx:",
        "  - Import: import { AppliedInsightsSection } from './applied-insights-section';",
        "  - Replace placeholder (lines 233-248) with: <AppliedInsightsSection skillChanges={impactData.skillChanges} injuries={impactData.injuriesRecorded} />",
        "",
        "Type check passes: npm run check-types",
        "Visual verification: Categories collapse/expand, links to passport work, cards display correctly"
      ],
      "technicalNotes": {
        "imports": [
          "import { Collapsible, CollapsibleTrigger, CollapsibleContent } from '@/components/ui/collapsible';",
          "import { Card, CardContent } from '@/components/ui/card';",
          "import { Badge } from '@/components/ui/badge';",
          "import { Button } from '@/components/ui/button';",
          "import { TrendingUp, AlertCircle, ChevronDown } from 'lucide-react';",
          "import { formatDistanceToNow } from 'date-fns';",
          "import Link from 'next/link';",
          "import { cn } from '@/lib/utils';"
        ],
        "stateManagement": "Use useState for expandedCategory to control which section is open",
        "linkPattern": "Link to player passport with tab query param: ?tab=skills or ?tab=health",
        "referenceFile": "scripts/ralph/P8_WEEK2_PREPARATION.md - Applied Insights Section pattern"
      },
      "priority": 3,
      "passes": false,
      "estimatedTime": "4-5 hours",
      "notes": "Most complex Week 2 component. Collapsible sections, multiple categories, links to passports."
    },
    {
      "id": "US-P8-008",
      "title": "Add Date Range Filtering to My Impact Tab",
      "description": "As a coach, I want to filter My Impact data by date range so I can see specific time periods (this week, this month, this season).",
      "phase": "P8 Week 2: My Impact Dashboard",
      "acceptanceCriteria": [
        "Modify apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/my-impact-tab.tsx",
        "",
        "Date range selector is ALREADY IMPLEMENTED in Week 1 (lines 182-194):",
        "  - State: const [dateRange, setDateRange] = useState<DateRangeFilter>('month')",
        "  - localStorage persistence: useEffect saves preference",
        "  - Options: 'week', 'month', 'all'",
        "  - Query parameter: dateRange: getDateRangeForFilter(dateRange)",
        "",
        "THIS STORY: Enhance existing implementation with additional options:",
        "",
        "1. Add new date range options to Select:",
        "   <SelectContent>",
        "     <SelectItem value='week'>Last 7 Days</SelectItem>",
        "     <SelectItem value='month'>Last 30 Days</SelectItem>",
        "     <SelectItem value='quarter'>Last 3 Months</SelectItem>  {/* NEW */}",
        "     <SelectItem value='season'>This Season</SelectItem>      {/* NEW */}",
        "     <SelectItem value='all'>All Time</SelectItem>",
        "   </SelectContent>",
        "",
        "2. Update DateRangeFilter type:",
        "   type DateRangeFilter = 'week' | 'month' | 'quarter' | 'season' | 'all';",
        "",
        "3. Update getDateRangeForFilter function:",
        "   case 'quarter':",
        "     return { start: now - (90 * 24 * 60 * 60 * 1000), end: now };",
        "   case 'season':",
        "     // Calculate season start (Sept 1 if after Sept, else previous Sept 1)",
        "     const currentYear = new Date().getFullYear();",
        "     const currentMonth = new Date().getMonth();",
        "     const seasonStartYear = currentMonth >= 8 ? currentYear : currentYear - 1;",
        "     const seasonStart = new Date(seasonStartYear, 8, 1).getTime(); // Sept 1",
        "     return { start: seasonStart, end: now };",
        "",
        "4. Add display of selected range in header:",
        "   <p className='text-muted-foreground text-sm'>",
        "     {dateRange === 'week' && 'Last 7 days'}",
        "     {dateRange === 'month' && 'Last 30 days'}",
        "     {dateRange === 'quarter' && 'Last 3 months'}",
        "     {dateRange === 'season' && 'This season'}",
        "     {dateRange === 'all' && 'All time'}",
        "   </p>",
        "",
        "5. Verify all sections update when date range changes:",
        "   - Summary cards (via impactData prop)",
        "   - Sent summaries section (via impactData.recentSummaries)",
        "   - Applied insights section (via impactData.skillChanges, injuriesRecorded)",
        "   - Team observations section (via impactData.teamObservations)",
        "",
        "Type check passes: npm run check-types",
        "Visual verification: Changing date range updates all sections, selected range displays in header"
      ],
      "technicalNotes": {
        "seasonLogic": "Sports season typically Sept 1 - Aug 31, adjust if organization uses different calendar",
        "quarterCalculation": "90 days = 3 months approximation",
        "queryReactivity": "useQuery automatically re-runs when dateRange changes, all sections get new data",
        "referenceFile": "scripts/ralph/P8_WEEK2_PREPARATION.md - Date Range Filtering section"
      },
      "priority": 4,
      "passes": false,
      "estimatedTime": "2-3 hours",
      "notes": "Enhancement to existing Week 1 implementation. Adds 'quarter' and 'season' options + display label."
    },
    {
      "id": "US-P8-009",
      "title": "Create Team Observations Section Component",
      "description": "As a coach, I want to see team-level observations I've made so I can track team dynamics and culture insights.",
      "phase": "P8 Week 2: My Impact Dashboard",
      "acceptanceCriteria": [
        "Create apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/team-observations-section.tsx",
        "",
        "Component structure:",
        "  export function TeamObservationsSection({ observations }: { observations: Array<{ observationId, teamName?, teamId?, title, description, appliedAt, voiceNoteId }> })",
        "",
        "Section header:",
        "  <div className='mb-4 flex items-center justify-between'>",
        "    <h3 className='font-semibold text-lg'>Team Observations</h3>",
        "    <Badge variant='secondary'>{observations.length} observations</Badge>",
        "  </div>",
        "",
        "Observation cards (limit to 10):",
        "  <div className='space-y-3'>",
        "    {observations.slice(0, 10).map(obs => (",
        "      <Card key={obs.observationId}>",
        "        <CardContent className='p-4'>",
        "          <div className='flex items-start gap-3'>",
        "            <div className='flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-blue-100'>",
        "              <Users className='h-5 w-5 text-blue-600' />",
        "            </div>",
        "            <div className='flex-1'>",
        "              <div className='flex items-center gap-2'>",
        "                <p className='font-medium'>{obs.teamName || 'General Observation'}</p>",
        "                <Badge variant='outline' className='text-xs'>Team</Badge>",
        "              </div>",
        "              <p className='mt-1 text-sm'>{obs.title}</p>",
        "              <p className='mt-1 text-muted-foreground text-sm'>{obs.description}</p>",
        "              <p className='mt-2 text-muted-foreground text-xs'>",
        "                {formatDistanceToNow(new Date(obs.appliedAt), { addSuffix: true })}",
        "              </p>",
        "            </div>",
        "          </div>",
        "        </CardContent>",
        "      </Card>",
        "    ))}",
        "  </div>",
        "",
        "'View All' button (if > 10):",
        "  {observations.length > 10 && (",
        "    <Button variant='outline' className='mt-4 w-full'>",
        "      View All {observations.length} Observations",
        "    </Button>",
        "  )}",
        "",
        "Empty state:",
        "  {observations.length === 0 && (",
        "    <Empty>",
        "      <EmptyMedia><Users className='h-12 w-12' /></EmptyMedia>",
        "      <EmptyContent>",
        "        <EmptyTitle>No team observations yet</EmptyTitle>",
        "        <EmptyDescription>Team-level insights from voice notes will appear here</EmptyDescription>",
        "      </EmptyContent>",
        "    </Empty>",
        "  )}",
        "",
        "Modify my-impact-tab.tsx:",
        "  - Import: import { TeamObservationsSection } from './team-observations-section';",
        "  - Replace placeholder (lines 250-265) with: <TeamObservationsSection observations={impactData.teamObservations} />",
        "",
        "Type check passes: npm run check-types",
        "Visual verification: Observations display correctly, team names show (or 'General'), timestamps formatted"
      ],
      "technicalNotes": {
        "imports": [
          "import { Card, CardContent } from '@/components/ui/card';",
          "import { Badge } from '@/components/ui/badge';",
          "import { Button } from '@/components/ui/button';",
          "import { Users } from 'lucide-react';",
          "import { formatDistanceToNow } from 'date-fns';",
          "import { Empty, EmptyMedia, EmptyContent, EmptyTitle, EmptyDescription } from '@/components/ui/empty';"
        ],
        "teamNameHandling": "Show obs.teamName if present, else 'General Observation' for org-wide insights",
        "iconColor": "Blue theme for team observations (bg-blue-100, text-blue-600)",
        "referenceFile": "scripts/ralph/P8_WEEK2_PREPARATION.md - Team Observations Section"
      },
      "priority": 5,
      "passes": false,
      "estimatedTime": "2-3 hours",
      "notes": "Completes core dashboard sections. Simpler than Applied Insights (no collapsible sections)."
    },
    {
      "id": "US-P8-010",
      "title": "Add Search to Applied Insights Section",
      "description": "As a coach, I want to search applied insights so I can quickly find specific observations or players.",
      "phase": "P8 Week 2: My Impact Dashboard",
      "acceptanceCriteria": [
        "Modify apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/applied-insights-section.tsx",
        "",
        "Add search state:",
        "  const [searchQuery, setSearchQuery] = useState('');",
        "  const [debouncedQuery, setDebouncedQuery] = useState('');",
        "",
        "Debounce search (300ms):",
        "  useEffect(() => {",
        "    const timer = setTimeout(() => setDebouncedQuery(searchQuery), 300);",
        "    return () => clearTimeout(timer);",
        "  }, [searchQuery]);",
        "",
        "Add search input above insights:",
        "  <div className='mb-4 flex items-center gap-2'>",
        "    <Input",
        "      placeholder='Search by player name or insight...'",
        "      value={searchQuery}",
        "      onChange={(e) => setSearchQuery(e.target.value)}",
        "      className='flex-1'",
        "    />",
        "    {searchQuery && (",
        "      <Button variant='ghost' size='icon' onClick={() => setSearchQuery('')}>",
        "        <X className='h-4 w-4' />",
        "      </Button>",
        "    )}",
        "  </div>",
        "",
        "Filter insights by search:",
        "  const filteredSkills = useMemo(() => {",
        "    if (!debouncedQuery) return skillChanges;",
        "    const lower = debouncedQuery.toLowerCase();",
        "    return skillChanges.filter(skill =>",
        "      skill.playerName.toLowerCase().includes(lower) ||",
        "      skill.description.toLowerCase().includes(lower)",
        "    );",
        "  }, [skillChanges, debouncedQuery]);",
        "",
        "  const filteredInjuries = useMemo(() => {",
        "    if (!debouncedQuery) return injuries;",
        "    const lower = debouncedQuery.toLowerCase();",
        "    return injuries.filter(injury =>",
        "      injury.playerName.toLowerCase().includes(lower) ||",
        "      injury.description.toLowerCase().includes(lower)",
        "    );",
        "  }, [injuries, debouncedQuery]);",
        "",
        "Show result count:",
        "  {debouncedQuery && (",
        "    <p className='mb-2 text-muted-foreground text-sm'>",
        "      Showing {filteredSkills.length + filteredInjuries.length} of {skillChanges.length + injuries.length} insights",
        "    </p>",
        "  )}",
        "",
        "Empty state when no results:",
        "  {debouncedQuery && filteredSkills.length === 0 && filteredInjuries.length === 0 && (",
        "    <Empty>",
        "      <EmptyTitle>No insights matching '{debouncedQuery}'</EmptyTitle>",
        "      <EmptyDescription>Try a different search term</EmptyDescription>",
        "    </Empty>",
        "  )}",
        "",
        "Use filteredSkills and filteredInjuries instead of skillChanges and injuries in category sections",
        "",
        "Type check passes: npm run check-types",
        "Visual verification: Search filters in real-time, clear button works, result count displays, empty state shows"
      ],
      "technicalNotes": {
        "imports": [
          "import { Input } from '@/components/ui/input';",
          "import { X } from 'lucide-react';",
          "import { useState, useEffect, useMemo } from 'react';"
        ],
        "debouncePattern": "300ms delay prevents excessive re-renders while typing",
        "performanceOptimization": "useMemo caches filtered results until dependencies change",
        "searchMatching": "Case-insensitive search with .toLowerCase(), matches playerName or description",
        "referenceFile": "scripts/ralph/P8_WEEK2_PREPARATION.md - Search pattern"
      },
      "priority": 6,
      "passes": false,
      "estimatedTime": "2-3 hours",
      "notes": "Enhances Applied Insights component. Makes insights searchable for coaches with many observations."
    },
    {
      "id": "US-P8-011",
      "title": "Add Category Filters to Applied Insights Section",
      "description": "As a coach, I want to filter applied insights by category so I can focus on specific types of observations.",
      "phase": "P8 Week 2: My Impact Dashboard",
      "acceptanceCriteria": [
        "Modify apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/applied-insights-section.tsx",
        "",
        "Add category filter state:",
        "  const [selectedCategories, setSelectedCategories] = useState<string[]>(['all']);",
        "",
        "Add filter chips above search:",
        "  <div className='mb-4 flex flex-wrap gap-2'>",
        "    {[",
        "      { id: 'all', label: 'All', count: skillChanges.length + injuries.length },",
        "      { id: 'skills', label: 'Skills', count: skillChanges.length },",
        "      { id: 'injuries', label: 'Injuries', count: injuries.length },",
        "    ].map(category => (",
        "      <Button",
        "        key={category.id}",
        "        variant={selectedCategories.includes(category.id) ? 'default' : 'outline'}",
        "        size='sm'",
        "        onClick={() => {",
        "          if (category.id === 'all') {",
        "            setSelectedCategories(['all']);",
        "          } else {",
        "            const newCategories = selectedCategories.filter(c => c !== 'all');",
        "            if (newCategories.includes(category.id)) {",
        "              const filtered = newCategories.filter(c => c !== category.id);",
        "              setSelectedCategories(filtered.length === 0 ? ['all'] : filtered);",
        "            } else {",
        "              setSelectedCategories([...newCategories, category.id]);",
        "            }",
        "          }",
        "        }}",
        "      >",
        "        {category.label}",
        "        <Badge variant='secondary' className='ml-2'>{category.count}</Badge>",
        "      </Button>",
        "    ))}",
        "  </div>",
        "",
        "Combine category filter with search filter:",
        "  const filteredSkills = useMemo(() => {",
        "    // First filter by category",
        "    let filtered = selectedCategories.includes('all') || selectedCategories.includes('skills')",
        "      ? skillChanges",
        "      : [];",
        "    // Then filter by search",
        "    if (debouncedQuery) {",
        "      const lower = debouncedQuery.toLowerCase();",
        "      filtered = filtered.filter(skill =>",
        "        skill.playerName.toLowerCase().includes(lower) ||",
        "        skill.description.toLowerCase().includes(lower)",
        "      );",
        "    }",
        "    return filtered;",
        "  }, [skillChanges, selectedCategories, debouncedQuery]);",
        "",
        "  const filteredInjuries = useMemo(() => {",
        "    // First filter by category",
        "    let filtered = selectedCategories.includes('all') || selectedCategories.includes('injuries')",
        "      ? injuries",
        "      : [];",
        "    // Then filter by search",
        "    if (debouncedQuery) {",
        "      const lower = debouncedQuery.toLowerCase();",
        "      filtered = filtered.filter(injury =>",
        "        injury.playerName.toLowerCase().includes(lower) ||",
        "        injury.description.toLowerCase().includes(lower)",
        "      );",
        "    }",
        "    return filtered;",
        "  }, [injuries, selectedCategories, debouncedQuery]);",
        "",
        "Hide category sections when filtered out:",
        "  {(selectedCategories.includes('all') || selectedCategories.includes('skills')) && (",
        "    <Collapsible ...>",
        "      {/* Skills section */}",
        "    </Collapsible>",
        "  )}",
        "",
        "  {(selectedCategories.includes('all') || selectedCategories.includes('injuries')) && (",
        "    <Collapsible ...>",
        "      {/* Injuries section */}",
        "    </Collapsible>",
        "  )}",
        "",
        "Type check passes: npm run check-types",
        "Visual verification: Category filters toggle correctly, count badges accurate, works with search"
      ],
      "technicalNotes": {
        "multiSelectLogic": "Allow multiple categories selected (OR logic), 'All' deselects others",
        "filterCombination": "First filter by category, then by search term (both filters apply)",
        "visualFeedback": "Selected categories use 'default' variant (filled), unselected use 'outline'",
        "countBadges": "Show total count per category, updates based on filters",
        "referenceFile": "scripts/ralph/P8_WEEK2_PREPARATION.md - Category Filters pattern"
      },
      "priority": 7,
      "passes": false,
      "estimatedTime": "2-3 hours",
      "notes": "Final Week 2 story. Completes Applied Insights with full search + filter capability."
    }
  ],
  "qualityChecks": {
    "beforeCommitting": [
      "npm run check-types - MUST pass for all new components",
      "npx ultracite fix - MUST pass",
      "Visual verification in browser at 3 breakpoints: 375px (mobile), 768px (tablet), 1920px (desktop)",
      "Test empty states: No voice notes, no summaries, no insights",
      "Test loading states: Verify skeleton components display while query loads",
      "Test with real data: Create voice notes, apply insights, send summaries, verify dashboard updates",
      "Test date range filtering: Change range, verify all sections update",
      "Test search: Type query, verify results filter, verify clear button works",
      "Test category filters: Toggle categories, verify sections hide/show correctly"
    ],
    "testingStrategy": {
      "US-P8-005": [
        "Verify 4 cards display with correct data",
        "Verify responsive: 1 col (mobile), 2 cols (tablet), 4 cols (desktop)",
        "Verify icons colored correctly: blue, green, purple, amber",
        "Verify parent view rate displays as percentage with 1 decimal"
      ],
      "US-P8-006": [
        "Verify table displays on desktop (>= 768px)",
        "Verify cards display on mobile (< 768px)",
        "Verify status badges: Acknowledged (green), Viewed (gray), Sent (outline)",
        "Verify 'View All' button appears when > 10 summaries",
        "Verify empty state when no summaries sent"
      ],
      "US-P8-007": [
        "Verify categories collapse/expand on click",
        "Verify Skills section (green icon) displays skill changes",
        "Verify Injuries section (red icon) displays injuries",
        "Verify 'View in Passport' links navigate correctly with tab query param",
        "Verify empty state per category when no insights"
      ],
      "US-P8-008": [
        "Verify 'Last 3 Months' option works",
        "Verify 'This Season' option calculates Sept 1 start correctly",
        "Verify selected range displays in header",
        "Verify all sections update when range changes",
        "Verify localStorage persists selected range"
      ],
      "US-P8-009": [
        "Verify observations display with team name or 'General'",
        "Verify 'View All' button appears when > 10 observations",
        "Verify empty state when no team observations",
        "Verify timestamps formatted correctly"
      ],
      "US-P8-010": [
        "Verify search filters by player name (case-insensitive)",
        "Verify search filters by insight description",
        "Verify search debounced (300ms delay)",
        "Verify clear button (X) resets search",
        "Verify result count displays: 'Showing X of Y insights'",
        "Verify empty state when no results match"
      ],
      "US-P8-011": [
        "Verify 'All' filter shows all insights",
        "Verify selecting 'Skills' hides Injuries section",
        "Verify multiple categories can be selected (OR logic)",
        "Verify count badges update correctly",
        "Verify filters combine with search (both apply)"
      ]
    }
  },
  "weekCompletionCriteria": [
    "✅ All 7 user stories implemented (US-P8-005 to US-P8-011)",
    "✅ 4 new components created: impact-summary-cards.tsx, sent-summaries-section.tsx, applied-insights-section.tsx, team-observations-section.tsx",
    "✅ my-impact-tab.tsx updated: All placeholder sections replaced with real components",
    "✅ Dashboard displays comprehensive coaching impact metrics",
    "✅ Date filtering enhanced: Added 'quarter' and 'season' options",
    "✅ Search functionality: Insights searchable by player name and description",
    "✅ Category filters: Skills and Injuries filterable",
    "✅ Empty states: All sections handle empty data gracefully",
    "✅ Loading states: Skeleton components display while loading",
    "✅ Responsive design: Works on mobile (375px), tablet (768px), desktop (1920px)",
    "✅ Real-time updates: All sections update when impactData changes",
    "✅ Type checking passes: npm run check-types",
    "✅ Linting passes: npx ultracite fix",
    "✅ Visual verification complete: All components tested in browser",
    "✅ Navigation works: Links to player passports functional"
  ],
  "nextPhase": {
    "name": "P8 Week 3 - Navigation & Polish",
    "stories": "US-P8-012 to US-P8-020 (9 stories)",
    "description": "Add bi-directional navigation (insights → passports → voice notes), source badges on passports, parent engagement analytics, export functionality, loading skeletons, comparison with previous period"
  }
}
