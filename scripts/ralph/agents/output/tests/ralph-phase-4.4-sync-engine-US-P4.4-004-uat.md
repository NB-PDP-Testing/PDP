# UAT Test: US-P4.4-004 - Create sync engine orchestrator with conflict resolution

> Auto-generated: 2026-02-15 23:30
> Status: ‚è≥ Pending Execution

## Story
As the sync engine, I need to orchestrate the full sync process including change detection, conflict resolution, and atomic updates.

## Acceptance Criteria Checklist

- [ ] Create packages/backend/convex/actions/federationSyncEngine.ts
- [ ] Implement syncWithConflictResolution action with args: connectorId, organizationId, strategy
- [ ] Fetch federation data using connector's sync action (e.g., syncGAAMembers)
- [ ] For each federation member, find matching local player by externalIds
- [ ] If no match, create new player (no conflict)
- [ ] If match found, call detectChanges to identify changed fields and conflicts
- [ ] If conflicts exist, call resolveConflicts with configured strategy
- [ ] Apply resolved changes to local data atomically (all or nothing)
- [ ] Update player's lastSyncedAt timestamp
- [ ] Record sync in import session with conflict details
- [ ] Track stats: playersCreated, playersUpdated, conflictsDetected, conflictsResolved
- [ ] On error, rollback all changes and log failure
- [ ] Run npx -w packages/backend convex codegen and npm run check-types

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-P4.4-004"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
