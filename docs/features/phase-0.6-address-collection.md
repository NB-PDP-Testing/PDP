# PlayerARC - Phase 0.6: Address Collection Enhancement

> Auto-generated documentation - Last updated: 2026-02-04 17:47

## Status

- **Branch**: `ralph/phase-0.6-address-collection`
- **Progress**: 6 / 6 stories complete
- **Phase Status**: âœ… Complete

## Completed Features

### US-P0.6-001: Add address2 and county fields to user table schema

As a developer, I need additional address fields in the user table to store complete address information.

**Acceptance Criteria:**
- Add address2: v.optional(v.string()) to customUserTable in betterAuth/schema.ts
- Add county: v.optional(v.string()) to customUserTable in betterAuth/schema.ts
- Run npx -w packages/backend convex codegen successfully
- Typecheck passes: npm run check-types

### US-P0.6-002: Update userProfiles mutations and queries

As a developer, I need the backend to accept and return the new address fields.

**Acceptance Criteria:**
- Update updateProfile mutation args to include address2 and county
- Update getProfileStatus query returns to include address2 and county
- Update updateProfileCompletion component function in userFunctions.ts
- All new fields are passed through and saved correctly
- Typecheck passes

### US-P0.6-003: Create address data constants file

As a developer, I need reference data for countries, Irish counties, and US states.

**Acceptance Criteria:**
- Create apps/web/src/lib/constants/address-data.ts
- Export TOP_COUNTRIES array: Ireland, United Kingdom, United States
- Export ALL_COUNTRIES array with ISO 3166-1 codes and names
- Export IRISH_COUNTIES array with 26 Republic of Ireland counties
- Export US_STATES array with 50 states + DC + territories
- Typecheck passes

### US-P0.6-004: Update ProfileCompletionStep with address fields

As a user, I need to be able to enter my full address during onboarding.

**Acceptance Criteria:**
- Add Street Address (address) input field
- Add Address Line 2 (address2) input field
- Add Town/City (town) input field - already exists, ensure visible
- Add Country dropdown with Ireland, UK, US at top, then alphabetical
- Add dynamic County field: dropdown for IE (26 counties + Other), dropdown for US (states + Other), text input for GB and others
- Postcode field already exists - ensure it remains
- All fields optional - no required validation
- Address fields in collapsible section labeled 'Address (Optional)'
- Form submission includes all new fields
- Typecheck passes

### US-P0.6-005: Display address in expanded user profile

As an admin, I need to see user addresses in the expanded profile on the Manage Users page.

**Acceptance Criteria:**
- Add Address section to expanded user profile in Manage Users page
- Display address fields in formatted layout (see PRD section 3.4)
- Address does NOT appear on collapsed user card
- Handle missing/partial address gracefully (only show fields that have values)
- Country code (IE, GB, US) displayed as full name (Ireland, United Kingdom, United States)
- Typecheck passes

### US-P0.6-006: End-to-end testing and verification

As a developer, I need to verify the complete address collection flow works correctly.

**Acceptance Criteria:**
- Test: User enters full Irish address with county dropdown
- Test: User enters UK address with free text county
- Test: User enters US address with state dropdown
- Test: User enters partial address (only some fields)
- Test: Address displays correctly in expanded profile on Manage Users
- Test: Existing phone/postcode/altEmail collection still works
- Test: Guardian matching not affected by changes
- All linting passes: npx ultracite fix
- All type checks pass: npm run check-types


## Implementation Notes

### Key Patterns & Learnings


## Key Files


---
*Documentation auto-generated by Ralph Documenter Agent*
