# UAT Test: US-P4.4-002 - Implement change detection for federation data

> Auto-generated: 2026-02-15 23:23
> Status: â³ Pending Execution

## Story
As the sync engine, I need to detect which fields changed between federation data and local data to avoid unnecessary updates.

## Acceptance Criteria Checklist

- [ ] Create packages/backend/convex/lib/federation/changeDetector.ts
- [ ] Implement detectChanges function: (federationData, localData) => ChangeSummary
- [ ] Compare each field: firstName, lastName, DOB, email, phone, address
- [ ] Return ChangeSummary: { hasChanges: boolean, changedFields: string[], conflicts: Conflict[] }
- [ ] A conflict occurs when: both federation and local modified since last sync, values differ
- [ ] Changed field = federation value differs from local value AND local not modified since last sync
- [ ] Use lastSyncedAt timestamp to determine if local data modified
- [ ] Handle null/undefined gracefully: null vs empty string = no change
- [ ] Normalize before comparing: trim whitespace, lowercase emails, normalize phone numbers
- [ ] Add TypeScript types: ChangeSummary, Conflict
- [ ] Run npx ultracite fix

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-P4.4-002"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
