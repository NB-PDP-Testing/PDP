# UAT Test: US-P4.4-005 - Add sync queue to prevent concurrent syncs

> Auto-generated: 2026-02-15 23:40
> Status: â³ Pending Execution

## Story
As the platform, I need to prevent multiple syncs running concurrently for the same organization to avoid race conditions and data corruption.

## Acceptance Criteria Checklist

- [ ] Create packages/backend/convex/models/syncQueue.ts
- [ ] Add syncQueue table to schema: organizationId, connectorId, status (pending/running/completed/failed), startedAt, completedAt, error
- [ ] Add indexes: by_organizationId, by_status, by_org_and_status
- [ ] Implement enqueueSyncJob mutation: creates pending sync job
- [ ] Implement claimSyncJob mutation: atomically marks pending job as running
- [ ] claimSyncJob fails if another job already running for same org+connector
- [ ] Implement completeSyncJob mutation: marks job as completed, updates stats
- [ ] Implement failSyncJob mutation: marks job as failed, logs error
- [ ] Sync engine checks queue before starting: skip if job already running
- [ ] Add timeout: mark jobs as failed if running >30 minutes (likely stuck)
- [ ] Add getSyncQueueStatus query: returns queue status for organization
- [ ] Run npx -w packages/backend convex codegen

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-P4.4-005"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
