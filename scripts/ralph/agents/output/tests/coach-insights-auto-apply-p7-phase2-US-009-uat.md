# UAT Test: US-009 - Add auto-applied insights UI to insights tab

> Auto-generated: 2026-01-26 11:59
> Status: ⏳ Pending Execution

## Story
As a coach, I see which insights were auto-applied and can review/undo them.

## Acceptance Criteria Checklist

- [ ] Edit apps/web/src/app/orgs/[orgId]/coach/voice-notes/components/insights-tab.tsx
- [ ] 1. Add second tab to insights section:
- [ ] - Existing: 'Pending Review' (current insights with status='pending')
- [ ] - NEW: 'Auto-Applied' (insights where autoAppliedByAI === true)
- [ ] 2. Add query to fetch auto-applied insights:
- [ ] - Create new query: getAutoAppliedInsights in voiceNoteInsights.ts
- [ ] - Args: { organizationId: v.string(), coachId: v.optional(v.string()) }
- [ ] - Returns insights with status='applied' and autoAppliedByAI=true
- [ ] - Include audit details from autoAppliedInsights table (join on insightId)
- [ ] - Sort by appliedAt descending (most recent first)
- [ ] 3. Display auto-applied insights in new tab:
- [ ] - Show all auto-applied insights for current coach
- [ ] - Use similar card layout as pending insights
- [ ] 4. Each auto-applied insight card shows:
- [ ] - Green badge: '✓ Auto-Applied'
- [ ] - Time applied: 'Applied 23 minutes ago' (use relative time)
- [ ] - What changed: 'Passing: 3 → 4' (show previousValue → newValue)
- [ ] - Player name and insight description
- [ ] - Confidence score with progress bar (existing US-003 component)
- [ ] 5. Add action buttons to each card:
- [ ] - [Undo] button:
- [ ] - Enabled if within 1 hour: (Date.now() - appliedAt) < 3600000
- [ ] - Disabled if expired with tooltip: 'Undo window expired'
- [ ] - Disabled if already undone with text: 'Undone'
- [ ] - [View Profile] button:
- [ ] - Links to player profile to see change in context
- [ ] 6. Undo button click opens confirmation dialog:
- [ ] - Dialog title: 'Undo Auto-Applied Insight'
- [ ] - Message: 'This will revert the player's rating back to {previousValue}. Why are you undoing this?'
- [ ] - Radio button options:
- [ ] - 'Wrong player - AI applied to incorrect player'
- [ ] - 'Wrong rating - The suggested rating was incorrect'
- [ ] - 'Insight incorrect - The insight itself was wrong'
- [ ] - 'Other (please explain)'
- [ ] - If 'Other' selected, show text area for explanation
- [ ] - [Cancel] and [Undo] buttons
- [ ] 7. On undo confirmation:
- [ ] - Call undoAutoAppliedInsight mutation with reason
- [ ] - Show loading state on button
- [ ] - On success: Toast notification 'Auto-apply undone. Skill rating reverted to {previousValue}.'
- [ ] - Refresh auto-applied insights list
- [ ] - On error: Toast notification with error message
- [ ] 8. Add empty state for auto-applied tab:
- [ ] - When no auto-applied insights exist:
- [ ] - Show icon and message: 'No auto-applied insights yet'
- [ ] - Subtitle: 'When you reach Level 2, high-confidence skill insights will auto-apply here'
- [ ] Type check passes: npm run check-types
- [ ] Visual verification in browser:
- [ ] - Tabs display correctly
- [ ] - Auto-applied insights show with green badge
- [ ] - Time displays update (e.g., '5 minutes ago')
- [ ] - Undo button enables/disables based on time
- [ ] - Undo dialog opens and submits correctly
- [ ] - Toast notifications appear on undo

## Test Scenarios

### Happy Path
1. Navigate to the feature
2. Perform the primary action described in the story
3. Verify all acceptance criteria are met
4. **Expected:** Feature works as described

### Edge Cases
1. Test with empty/null values
2. Test with boundary values
3. Test rapid repeated actions
4. **Expected:** Graceful handling, no errors

### Error Handling
1. Test with invalid inputs
2. Test without proper permissions
3. Test with network issues (if applicable)
4. **Expected:** Clear error messages, no crashes

## Visual Verification
- [ ] UI matches design expectations
- [ ] Responsive on mobile (if applicable)
- [ ] Loading states are appropriate
- [ ] Error states are user-friendly

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
