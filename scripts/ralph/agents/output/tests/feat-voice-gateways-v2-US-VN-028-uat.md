# UAT Test: US-VN-028 - Remove Dual Processing Path

> Auto-generated: 2026-02-09 12:33
> Status: ⏳ Pending Execution

## Story
Gate buildInsights scheduling so it NEVER runs when v2 is active. Add skipV2 param to createTypedNote/createRecordedNote so WhatsApp callers don't create double artifacts.

## Acceptance Criteria Checklist

- [ ] === FULL DETAILS IN: scripts/ralph/prds/voice-gateways-v2/phases/PHASE7D_PRD.json ===
- [ ] 4 CHANGES:
- [ ] 1. createTypedNote: wrap buildInsights in if (!useV2) — reuse existing useV2 variable
- [ ] 2. transcribeAudio: wrap buildInsights in if (artifacts.length === 0) — reuse existing artifacts variable
- [ ] 3. Add skipV2: v.optional(v.boolean()) to createTypedNote & createRecordedNote, pass from WhatsApp callers
- [ ] 4. Update defense-in-depth log in buildInsights to say 'Defense-in-depth'
- [ ] CRITICAL: Do NOT call shouldUseV2Pipeline twice — reuse the useV2 variable from Phase 7A
- [ ] CRITICAL: Quality gate checks MUST stay BEFORE buildInsights gating in transcribeAudio
- [ ] CRITICAL: skipV2 on public API is simpler than needing internal versions

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-VN-028"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
