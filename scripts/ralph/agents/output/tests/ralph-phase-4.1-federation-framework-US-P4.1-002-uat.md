# UAT Test: US-P4.1-002 - Implement credential encryption utilities

> Auto-generated: 2026-02-15 20:56
> Status: ‚è≥ Pending Execution

## Story
As a platform, I need to securely encrypt and decrypt federation credentials (OAuth tokens, API keys) before storing them in Convex file storage.

## Acceptance Criteria Checklist

- [ ] Create packages/backend/convex/lib/federation/encryption.ts
- [ ] Implement encryptCredentials function: accepts credentials object, returns encrypted buffer
- [ ] Implement decryptCredentials function: accepts encrypted buffer, returns credentials object
- [ ] Use Web Crypto API (crypto.subtle) for AES-GCM encryption
- [ ] Encryption key stored in Convex environment variable: FEDERATION_ENCRYPTION_KEY
- [ ] Generate initialization vector (IV) per encryption (prepend to ciphertext)
- [ ] Return encrypted data as base64 string for storage
- [ ] Add error handling for missing encryption key
- [ ] Add TypeScript types: FederationCredentials (union of OAuth2Credentials, ApiKeyCredentials, BasicAuthCredentials)
- [ ] Run npx ultracite fix

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-P4.1-002"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
