# UAT Test: US-P4.3-002 - Create Claude API integration action

> Auto-generated: 2026-02-15 22:31
> Status: ‚è≥ Pending Execution

## Story
As a developer, I need to call Claude API with a prompt and parse the response for column mapping suggestions.

## Acceptance Criteria Checklist

- [ ] Create packages/backend/convex/actions/aiMapping.ts
- [ ] Install @anthropic-ai/sdk package: npm install @anthropic-ai/sdk
- [ ] Add ANTHROPIC_API_KEY to Convex environment variables
- [ ] Implement callClaudeAPI action: accepts prompt (string), returns parsed response
- [ ] Use Claude 3.5 Sonnet model: 'claude-3-5-sonnet-20241022'
- [ ] Set max_tokens: 1024 (sufficient for mapping response)
- [ ] Set temperature: 0.3 (deterministic but creative enough)
- [ ] Parse response: expect JSON with { targetField, confidence, reasoning }
- [ ] Add error handling for API errors: 401 (invalid key), 429 (rate limit), 500 (server error)
- [ ] Implement retry logic with exponential backoff (3 retries max)
- [ ] Add TypeScript types: AIMappingRequest, AIMappingResponse
- [ ] Run npx ultracite fix and npm run check-types

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-P4.3-002"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
