# UAT Test: US-VNM-002 - Build Event Logging Infrastructure

> Auto-generated: 2026-02-16 14:00
> Status: â³ Pending Execution

## Story
Create voicePipelineEvents.ts with logEvent mutation (atomic counter increment), event queries, and cursor-based pagination. READ FULL DETAILS in phases/PHASE_M1.json.

## Acceptance Criteria Checklist

- [ ] Create packages/backend/convex/models/voicePipelineEvents.ts
- [ ] Implement logEvent internalMutation with atomic counter increment (steps 1-6 in PHASE_M1.json)
- [ ] Counter increment MUST be in same transaction as event insert
- [ ] Counter window rotation: reset to 1 when Date.now() >= windowEnd (atomic patch)
- [ ] Implement getRecentEvents query with .paginate() - NEVER .take()
- [ ] Implement getEventsByArtifact internalQuery (no pagination - bounded by artifact)
- [ ] Implement getEventTimeline query with platform staff auth
- [ ] Implement getActiveArtifacts query (queries voiceNoteArtifacts, not events)
- [ ] Implement getFailedArtifacts query with optional sinceTimestamp filter
- [ ] All public queries verify isPlatformStaff authorization
- [ ] Test logEvent via Convex dashboard - verify counter incremented
- [ ] Run: npx -w packages/backend convex codegen && npm run check-types

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-VNM-002"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
