{
  "project": "PlayerARC",
  "branchName": "ralph/onboarding-missing-features",
  "description": "Onboarding System Missing Features - Notification Preferences, Setup Wizard UI, Graduation Celebration UI, Mobile Navigation",
  "relatedIssues": ["#371"],
  "dependencies": [],
  "priority": "HIGH",
  "userStories": [
    {
      "id": "US-001",
      "title": "Organization setup wizard display",
      "description": "As a new organization owner, I want a setup wizard to guide me through initial configuration so I know what to set up.",
      "acceptanceCriteria": [
        "Setup wizard modal/page appears for organization owners when setupComplete is false/undefined",
        "Wizard shows step indicator (e.g., 'Step 1 of 5')",
        "Wizard has progress bar showing completion percentage",
        "Next/Back navigation buttons work correctly",
        "Add data-testid='first-user-wizard' or data-testid='org-setup-wizard' to wizard container",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Phase 5 - High Priority - Impacts first-time user experience"
    },
    {
      "id": "US-002",
      "title": "Setup wizard step navigation",
      "description": "As an owner, I want to navigate between setup wizard steps so I can complete configuration at my pace.",
      "acceptanceCriteria": [
        "Wizard has 5 steps: Welcome, Details, Branding, Team, Complete",
        "Step indicator shows current step with data-testid='wizard-step-indicator'",
        "Current step has aria-current='step' attribute",
        "Next button advances to next step",
        "Back button returns to previous step",
        "Form data is preserved when navigating between steps",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Phase 5 - Navigation between wizard steps"
    },
    {
      "id": "US-003",
      "title": "Setup wizard branding step",
      "description": "As an owner, I want to set my organization's branding (colors, logo) so my club looks professional.",
      "acceptanceCriteria": [
        "Branding step has color picker for primary color",
        "Branding step has color picker for secondary color",
        "Optional tertiary color picker",
        "Logo upload input (input[type='file']) or drag-drop zone",
        "Add data-testid='org-colors' to color section",
        "Add data-testid='logo-upload' to logo upload area",
        "Colors save to organization record",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Phase 5 - Organization branding configuration"
    },
    {
      "id": "US-004",
      "title": "Setup progress tracking",
      "description": "As an owner, I want to see my setup progress so I know what's left to complete.",
      "acceptanceCriteria": [
        "Progress indicator shows percentage or 'X of Y steps'",
        "Progress bar has role='progressbar' attribute",
        "Add data-testid='setup-progress' to progress section",
        "Current setupStep is saved to user record",
        "Progress survives page refresh",
        "User can resume from last step on return",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Phase 5 - Progress persistence"
    },
    {
      "id": "US-005",
      "title": "Setup wizard completion",
      "description": "As an owner, I want to know when setup is complete so I can start using the platform.",
      "acceptanceCriteria": [
        "Final step shows summary of what was configured",
        "'Finish Setup' button marks setup as complete",
        "Add data-testid='setup-complete' to completion state",
        "setupComplete: true is saved to user/org record",
        "Wizard does not reappear after completion",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Phase 5 - Setup completion detection"
    },
    {
      "id": "US-006",
      "title": "Settings page organization editing",
      "description": "As an owner, I want to edit organization settings after setup so I can update branding later.",
      "acceptanceCriteria": [
        "Settings page at /orgs/[orgId]/admin/settings shows all wizard-configured values",
        "Edit button or inline editing available",
        "Save/Update button with data-testid='edit-org' or button[type='submit']",
        "Required fields have aria-required='true'",
        "Validation errors display for invalid input",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Phase 5 - Post-setup editing"
    },
    {
      "id": "US-007",
      "title": "Team creation prompt in setup",
      "description": "As an owner, I want to be prompted to create my first team during setup so I can get started quickly.",
      "acceptanceCriteria": [
        "Team creation step in wizard OR empty state with 'Create First Team' prompt",
        "Team form has name, sport, age group fields",
        "'Skip for now' option available",
        "Created team appears in team list after completion",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Phase 5 - Initial team creation"
    },
    {
      "id": "US-008",
      "title": "Graduation celebration UI",
      "description": "As a user who completes onboarding, I want to see a celebration/congratulations message so I feel accomplished.",
      "acceptanceCriteria": [
        "Celebration modal/overlay appears when all onboarding steps complete",
        "Modal has 'Congratulations!' heading",
        "Add data-testid='graduation' or data-testid='celebration' to modal",
        "Optional confetti animation with data-testid='confetti'",
        "Completion summary shows completed steps with data-testid='completion-summary'",
        "'Get Started', 'Continue', or 'Close' button dismisses modal",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Phase 7 - High Priority - Celebration UI when onboarding complete"
    },
    {
      "id": "US-009",
      "title": "Onboarding completion detection",
      "description": "As the system, I need to detect when all onboarding steps are complete to trigger graduation UI.",
      "acceptanceCriteria": [
        "isOnboardingComplete() checks user.onboardingComplete OR (gdprConsentVersion AND setupComplete)",
        "Add data-testid='onboarding-complete' indicator when complete",
        "Add data-testid='onboarding-status' to show current state",
        "Completion state persists across page refresh",
        "Completion state persists across sessions",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Phase 7 - Completion detection logic"
    },
    {
      "id": "US-010",
      "title": "Re-onboarding prevention",
      "description": "As a completed user, I want to not see the onboarding wizard again so I'm not interrupted.",
      "acceptanceCriteria": [
        "Once onboardingComplete: true, wizard does not show automatically",
        "Navigation between pages does not trigger wizard",
        "Page refresh does not trigger wizard",
        "Wizard marked with data-completed='true' attribute if shown for completed users",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Phase 7 - Prevent re-triggering"
    },
    {
      "id": "US-011",
      "title": "Onboarding progress tracking UI",
      "description": "As a user, I want to see my onboarding progress so I know what steps I've completed.",
      "acceptanceCriteria": [
        "Progress indicator on dashboard or settings shows completion percentage",
        "Add data-testid='progress' with role='progressbar'",
        "Visual checklist shows completed steps with data-testid='step-complete'",
        "Completed steps have aria-checked='true' or checkmark icon",
        "Shows 'X of Y steps complete' text",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Phase 7 - Progress visualization"
    },
    {
      "id": "US-012",
      "title": "Optional restart onboarding",
      "description": "As a user, I want to optionally restart onboarding from settings if I want a refresher.",
      "acceptanceCriteria": [
        "'Restart Onboarding' button in settings page",
        "Add data-testid='restart-onboarding' to button",
        "Clicking shows confirmation dialog with role='alertdialog'",
        "Dialog warns about what will happen",
        "Confirmation resets onboardingComplete and shows wizard",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Phase 7 - Re-visit feature"
    },
    {
      "id": "US-013",
      "title": "Help/tour without resetting onboarding",
      "description": "As a user, I want to access help/tour content without resetting my onboarding progress.",
      "acceptanceCriteria": [
        "Help button accessible from dashboard with data-testid='help-button'",
        "Opens help content/tour with data-testid='help-content' or data-testid='tour'",
        "Does NOT reset onboardingComplete status",
        "Distinct from 'Restart Onboarding' button",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Phase 7 - Non-destructive help"
    },
    {
      "id": "US-014",
      "title": "Notification settings section",
      "description": "As a user, I want to access notification settings from my profile/settings page so I can control how I receive updates.",
      "acceptanceCriteria": [
        "Notification settings section visible at /orgs/[orgId]/admin/settings",
        "Also accessible from coach/parent settings equivalents",
        "Clear heading: 'Notification Preferences' or similar",
        "Add data-testid='notification-settings' or data-testid='notification-preferences'",
        "Grouped by notification type (email, push, in-app)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Phase 4 - Medium Priority - Independent feature"
    },
    {
      "id": "US-015",
      "title": "Email notification toggles",
      "description": "As a user, I want to toggle email notifications on/off so I can control my inbox.",
      "acceptanceCriteria": [
        "Master toggle for all email notifications (default ON)",
        "Individual toggles for: Team Updates, Player Updates, Announcements, Assessment Reminders",
        "All toggles use role='switch' with aria-checked attribute",
        "Add data-testid='email-notification-toggle' to master toggle",
        "Changes persist immediately (optimistic update)",
        "Changes survive page reload",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": true,
      "notes": "Phase 4 - Email preferences"
    },
    {
      "id": "US-016",
      "title": "Push notification setup",
      "description": "As a user, I want to enable/disable push notifications so I can control browser alerts.",
      "acceptanceCriteria": [
        "'Enable Push Notifications' button visible",
        "Clicking triggers browser permission request",
        "Status indicator shows: enabled, disabled, or blocked",
        "Add data-testid containing 'push' to push section",
        "Push subscription saved when enabled",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 16,
      "passes": true,
      "notes": "Phase 4 - Push notification setup"
    },
    {
      "id": "US-017",
      "title": "In-app notification toggles",
      "description": "As a user, I want to manage in-app notification preferences so I can control what appears in my notification center.",
      "acceptanceCriteria": [
        "Master toggle for in-app notifications (default ON)",
        "Sound alerts toggle (default OFF)",
        "Badge count toggle (default ON)",
        "Add data-testid containing 'in-app' to section",
        "All toggles use role='switch' with aria-checked",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": true,
      "notes": "Phase 4 - In-app notification preferences"
    },
    {
      "id": "US-018",
      "title": "Notification preferences data model",
      "description": "As a developer, I need a notification preferences table and backend functions to persist user preferences.",
      "acceptanceCriteria": [
        "Create notificationPreferences table in schema with userId, emailEnabled, emailTeamUpdates, emailPlayerUpdates, emailAnnouncements, emailAssessments, pushEnabled, pushSubscription, inAppEnabled, inAppSound, inAppBadge, createdAt, updatedAt",
        "Add indexes: by_userId, by_userId_orgId",
        "Create getNotificationPreferences(userId, orgId?) query",
        "Create updateNotificationPreferences(userId, preferences) mutation",
        "Create getDefaultNotificationPreferences() helper",
        "Run npx -w packages/backend convex codegen successfully",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": true,
      "notes": "Phase 4 - Backend data model"
    },
    {
      "id": "US-019",
      "title": "Onboarding backend functions",
      "description": "As a developer, I need backend functions to manage onboarding state.",
      "acceptanceCriteria": [
        "Create or extend models/onboarding.ts",
        "markOnboardingComplete(userId) mutation sets onboardingComplete: true",
        "getOnboardingProgress(userId) query returns completion status for each step",
        "resetOnboarding(userId) mutation resets onboardingComplete and setupComplete",
        "updateSetupStep(userId, step) mutation saves current wizard step",
        "Run npx -w packages/backend convex codegen successfully",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": true,
      "notes": "Phase 7 - Backend functions"
    },
    {
      "id": "US-020",
      "title": "Mobile hamburger menu button",
      "description": "As a mobile user, I want a hamburger menu button so I can access navigation on small screens.",
      "acceptanceCriteria": [
        "Hamburger icon button (three horizontal lines) visible on viewport < 768px",
        "Add data-testid='hamburger-menu' to button",
        "Button has accessible label with aria-label containing 'menu'",
        "Desktop navigation hidden on mobile",
        "Typecheck passes",
        "Verify in browser using dev-browser skill at mobile viewport"
      ],
      "priority": 20,
      "passes": true,
      "notes": "Mobile - Low Priority - UI polish"
    },
    {
      "id": "US-021",
      "title": "Mobile navigation panel",
      "description": "As a mobile user, I want a navigation panel that opens when I click the hamburger menu.",
      "acceptanceCriteria": [
        "Clicking hamburger opens navigation panel",
        "Panel contains all navigation links",
        "Add data-testid='mobile-menu' to panel",
        "Panel has role='navigation' or contains nav element",
        "Clicking nav item navigates and closes panel",
        "Panel can be closed without navigating (X button or click outside)",
        "Focus returns to hamburger button after close",
        "Typecheck passes"
      ],
      "priority": 21,
      "passes": true,
      "notes": "Mobile - Navigation panel functionality"
    }
  ],
  "verificationSteps": [
    "npm run check-types",
    "npx -w packages/backend convex codegen",
    "Run UAT tests: cd apps/web/uat && npx playwright test tests/onboarding/phase4-notifications.spec.ts",
    "Run UAT tests: cd apps/web/uat && npx playwright test tests/onboarding/phase5-first-user.spec.ts",
    "Run UAT tests: cd apps/web/uat && npx playwright test tests/onboarding/phase7-graduation.spec.ts",
    "Run UAT tests: cd apps/web/uat && npx playwright test tests/onboarding/mobile.spec.ts"
  ],
  "successCriteria": [
    "All phase4-notifications.spec.ts tests pass (4 tests)",
    "All phase5-first-user.spec.ts tests pass (7 tests)",
    "All phase7-graduation.spec.ts tests pass (8 tests)",
    "Mobile hamburger test passes (1 test)",
    "127 existing passing tests remain passing"
  ]
}
