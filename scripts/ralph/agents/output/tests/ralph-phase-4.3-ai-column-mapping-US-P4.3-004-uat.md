# UAT Test: US-P4.3-004 - Implement AI column mapper with caching

> Auto-generated: 2026-02-15 22:35
> Status: â³ Pending Execution

## Story
As the import system, I need to get AI-suggested mappings for CSV columns, using cached results when available.

## Acceptance Criteria Checklist

- [ ] Add to packages/backend/convex/actions/aiMapping.ts
- [ ] Implement suggestColumnMapping action with args: columnName, sampleValues (array of 3-5 values)
- [ ] Normalize columnName: lowercase, trim, remove special chars
- [ ] Check aiMappingCache for existing mapping (by columnPattern + sampleValues hash)
- [ ] If cached and not expired (expiresAt > now), return cached result
- [ ] If not cached or expired, build prompt using buildMappingPrompt
- [ ] Call Claude API with prompt
- [ ] Parse response JSON: { targetField, confidence, reasoning }
- [ ] Validate confidence is 0-100, targetField is in allowed fields list
- [ ] Store result in aiMappingCache with expiresAt = now + 30 days
- [ ] Return: { targetField, confidence, reasoning, cached: boolean }
- [ ] Log cache hit/miss for monitoring
- [ ] Run npx -w packages/backend convex codegen and npm run check-types

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-P4.3-004"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
