{
  "project": "Coach-Parent AI Summaries - Phase 2 (Trust Curve)",
  "branchName": "ralph/coach-parent-summaries-p2",
  "description": "Trust level tracking and progression system for coaches. Depends on Phase 1.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add coachTrustLevels table",
      "description": "As a developer, I need a table to store trust levels per coach.",
      "acceptanceCriteria": [
        "Add coachTrustLevels table to schema.ts with: coachId, organizationId, currentLevel (0-3)",
        "Add fields: preferredLevel, totalApprovals, totalSuppressed, consecutiveApprovals",
        "Add timestamps: lastActivityAt, createdAt, updatedAt",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Add levelHistory field and index",
      "description": "As a developer, I need to track trust level changes over time.",
      "acceptanceCriteria": [
        "Add levelHistory array field: [{ level, changedAt, reason }]",
        "Add index: by_coach_org for efficient lookups",
        "Run: npx -w packages/backend convex codegen",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create coachTrustLevels.ts model file",
      "description": "As a developer, I need the base model file.",
      "acceptanceCriteria": [
        "Create packages/backend/convex/models/coachTrustLevels.ts",
        "Add imports: v, mutation, query, authComponent",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create trustLevelCalculator lib",
      "description": "As a developer, I need a pure function to calculate trust level.",
      "acceptanceCriteria": [
        "Create packages/backend/convex/lib/trustLevelCalculator.ts",
        "Export calculateTrustLevel(totalApprovals, totalSuppressed, hasOptedIn)",
        "Return level 0-3 based on thresholds: 0=default, 1=10+, 2=50+ & <10% suppress, 3=200+ & opt-in",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Pure function, no DB access"
    },
    {
      "id": "US-005",
      "title": "Implement getOrCreateTrustLevel mutation",
      "description": "As a coach, my trust level should be created on first use.",
      "acceptanceCriteria": [
        "Add getOrCreateTrustLevel mutation with args: organizationId",
        "Query by_coach_org index for existing record",
        "If not found, create with currentLevel: 0, all counters: 0",
        "Return trust level object"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement updateTrustMetrics mutation",
      "description": "As the system, I need to update metrics after coach actions.",
      "acceptanceCriteria": [
        "Add updateTrustMetrics internalMutation with args: coachId, organizationId, action",
        "Action is: approved | suppressed | edited",
        "Increment relevant counter based on action",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Recalculate trust level in updateTrustMetrics",
      "description": "As a coach, my trust level should update when metrics change.",
      "acceptanceCriteria": [
        "After updating counters, call calculateTrustLevel",
        "If newLevel !== currentLevel, update currentLevel",
        "Append to levelHistory: { level: newLevel, changedAt, reason }",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Implement setCoachPreferredLevel mutation",
      "description": "As a coach, I want to set my preferred maximum trust level.",
      "acceptanceCriteria": [
        "Add setCoachPreferredLevel mutation with args: organizationId, preferredLevel",
        "Validate preferredLevel is 0-3",
        "Update preferredLevel field on trust record",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": "Coach can cap their automation level"
    },
    {
      "id": "US-009",
      "title": "Hook approveSummary to update trust metrics",
      "description": "As the system, approving a summary should update trust metrics.",
      "acceptanceCriteria": [
        "Edit coachParentSummaries.ts approveSummary mutation",
        "After successful approval, call updateTrustMetrics with action: approved",
        "Pass coachId, organizationId from summary",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Hook suppressSummary to update trust metrics",
      "description": "As the system, suppressing a summary should update trust metrics.",
      "acceptanceCriteria": [
        "Edit coachParentSummaries.ts suppressSummary mutation",
        "After successful suppression, call updateTrustMetrics with action: suppressed",
        "Pass coachId, organizationId from summary",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Implement getCoachTrustLevel query",
      "description": "As a coach, I want to view my current trust level.",
      "acceptanceCriteria": [
        "Add getCoachTrustLevel query with args: organizationId",
        "Get authenticated user, query their trust record",
        "Return trust level with metrics and progress to next level",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Create TrustLevelIndicator component",
      "description": "As a coach, I want to see my trust level visually.",
      "acceptanceCriteria": [
        "Create apps/web/src/components/coach/trust-level-indicator.tsx",
        "Props: trustLevel, metrics",
        "Show level name: New, Learning, Trusted, Expert",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Add progress bar to TrustLevelIndicator",
      "description": "As a coach, I want to see my progress to the next level.",
      "acceptanceCriteria": [
        "Calculate progress percentage based on current metrics",
        "Show progress bar to next level threshold",
        "Show key stats: approvals, suppression rate",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Add TrustLevelIndicator to voice notes dashboard",
      "description": "As a coach, I want to see my trust level in the dashboard.",
      "acceptanceCriteria": [
        "Edit voice-notes-dashboard.tsx",
        "Add useQuery for getCoachTrustLevel",
        "Render TrustLevelIndicator in header area",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Create TrustPreferenceSettings component",
      "description": "As a coach, I want to configure my trust preferences.",
      "acceptanceCriteria": [
        "Create apps/web/src/components/coach/trust-preference-settings.tsx",
        "Props: trustLevel, onUpdate",
        "Show radio buttons or slider for preferred level",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Add level explanations to TrustPreferenceSettings",
      "description": "As a coach, I want to understand what each level means.",
      "acceptanceCriteria": [
        "Show description for each level option",
        "Level 3 shows confirmation warning about full automation",
        "Call onUpdate when preference changes",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Create TrustNudgeBanner component",
      "description": "As a coach, I want encouragement when close to next level.",
      "acceptanceCriteria": [
        "Create apps/web/src/components/coach/trust-nudge-banner.tsx",
        "Props: trustLevel, metrics",
        "Show only when: level 0 with 8+ approvals, or level 1 with 45+ approvals",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Add nudge banner to voice notes dashboard",
      "description": "As a coach, nudges should appear in my dashboard.",
      "acceptanceCriteria": [
        "Edit voice-notes-dashboard.tsx",
        "Conditionally render TrustNudgeBanner based on trust data",
        "Allow dismissing banner (store in localStorage)",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Add link to trust settings from indicator",
      "description": "As a coach, I want to access settings from the indicator.",
      "acceptanceCriteria": [
        "Add settings icon/link to TrustLevelIndicator",
        "Opens modal or navigates to settings page",
        "Shows TrustPreferenceSettings component",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Wire trust preference save",
      "description": "As a coach, saving preferences should persist.",
      "acceptanceCriteria": [
        "Add useMutation for setCoachPreferredLevel",
        "Wire save handler in TrustPreferenceSettings",
        "Show toast on success",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    }
  ]
}
