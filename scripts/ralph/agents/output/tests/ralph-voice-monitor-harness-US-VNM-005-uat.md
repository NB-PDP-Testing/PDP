# UAT Test: US-VNM-005 - Add Metrics Aggregation Crons

> Auto-generated: 2026-02-16 19:27
> Status: ⏳ Pending Execution

## Story
Add 4 cron jobs for hourly aggregation, daily aggregation, and cleanup. READ FULL DETAILS in phases/PHASE_M2.json.

## Acceptance Criteria Checklist

- [ ] Modify packages/backend/convex/crons.ts to add 4 new cron jobs
- [ ] Cron 1: aggregate-pipeline-hourly-metrics (hourly at :30 - ensures full hour available)
- [ ] Cron 2: aggregate-pipeline-daily-metrics (daily at 1:30 AM UTC - ensures 24 hourly snapshots exist)
- [ ] Cron 3: cleanup-pipeline-snapshots (weekly Sunday 4:30 AM UTC)
- [ ] Cron 4: cleanup-pipeline-events (weekly Sunday 5:00 AM UTC - runs AFTER snapshot cleanup)
- [ ] CRITICAL TIMING: Hourly at :30 (NOT :00), Daily at 1:30 AM (NOT 12:00 AM)
- [ ] All crons call corresponding internal mutations from voicePipelineMetrics.ts
- [ ] Deploy to Convex: npx convex deploy
- [ ] Verify all 4 crons visible in Convex dashboard → Crons tab
- [ ] Manually trigger each cron from dashboard to test execution
- [ ] Verify hourly aggregation creates snapshots correctly
- [ ] Verify cleanup deletes old data without errors
- [ ] Run: npx -w packages/backend convex codegen

## Playwright E2E Tests
- Run: `npx -w apps/web playwright test --config=uat/playwright.config.ts -g "US-VNM-005"`
- Report: `npx -w apps/web playwright show-report uat/playwright-report`

## Notes
_Add testing observations here_

---
*Generated by Test Runner Agent*
